from ev3dev2.motor import MoveTank, OUTPUT_D, OUTPUT_A
import sys
import termios
import tty
import time
import select

tank_drive = MoveTank(OUTPUT_D, OUTPUT_A)

def get_key():
    '''Tjekker om der trykkes en tast uden at blokere'''
    dr, dw, de = select.select([sys.stdin], [], [], 0)
    if dr:
        return sys.stdin.read(1)
    return None

def main():
    print("Hold w/a/s/d for at køre. Slip for at stop. q = quit")

    # Gør terminal klar
    fd = sys.stdin.fileno()
    old_settings = termios.tcgetattr(fd)
    tty.setcbreak(fd)

    try:
        last_key = None
        while True:
            key = get_key()
            if key:
                last_key = key
                if key == 'q':
                    break

            if last_key == 'w':
                tank_drive.on(50, 50)
            elif last_key == 's':
                tank_drive.on(-50, -50)
            elif last_key == 'a':
                tank_drive.on(-30, 30)
            elif last_key == 'd':
                tank_drive.on(30, -30)
            else:
                tank_drive.off()

            time.sleep(0.05)  # hurtig loop for responsiv styring

            # "slip tasten"-simulering: nulstil efter lidt tid uden ny tast
            last_key = None

    finally:
        termios.tcsetattr(fd, termios.TCSADRAIN, old_settings)
        tank_drive.off()
        print("Robot stoppet og program afsluttet.")

if __name__ == "__main__":
    main()

